<p-accordion [multiple]="true" [activeIndex]="[0,1,2]">
  <p-accordionTab header="Aplicação">
    <div class="grid " style="min-height: 15rem;">
      <div class="col-12">
        <div class="flex gap-1" style="min-height: 20rem !important;">
          <div>

            <p-table [value]="menuGestao" [style]="{width:'15rem'}" dataKey="id" selectionMode="single"
              [(selection)]="selectedGestao" (onRowSelect)="onRowSelectGestao($event)"
              (onRowUnselect)="onRowUnselectGestao($event)">
              <ng-template pTemplate="caption">
                <div class="flex align-items-center justify-content-between">
                  Gestão
                </div>
              </ng-template>

              <ng-template pTemplate="body" let-gestao let-rowIndex="rowIndex">
                <tr [pSelectableRow]="gestao">
                  <td>{{gestao.descricao}}</td>
                </tr>
              </ng-template>
            </p-table>

          </div>
          <div>

            <p-table [value]="menuModulo" [style]="{width:'15rem'}" dataKey="id" selectionMode="single"
              [(selection)]="selectedModulo" (onRowSelect)="onRowSelectModulo($event)"
              (onRowUnselect)="onRowUnselectModulo($event)">
              <ng-template pTemplate="caption">
                <div class="flex align-items-center justify-content-between">
                  Módulos
                </div>
              </ng-template>

              <ng-template pTemplate="body" let-modulo let-rowIndex="rowIndex">
                <tr [pSelectableRow]="modulo">
                  <td>{{modulo.descricao}}</td>
                </tr>
              </ng-template>
            </p-table>

            <div style="text-align: center;">

              @if (selectedModulo.id) {
              <p-button pRipple severity="success" label="Change" icon="pi pi-file-edit" class="mr-2"
                (click)="showDialogModulo()" [disabled]="!selectedModulo!.id!" />
              } @else {
              <p-button pRipple severity="success" label="New" icon="pi pi-plus" class="mr-2"
                (click)="showDialogModulo()" [disabled]="!selectedGestao!.id!" />
              }
              <p-button pRipple severity="danger" label="Delete" icon="pi pi-trash"
                (click)="confirmExcluir($event,'modulo')" [disabled]="!selectedModulo!.id!" />
            </div>
          </div>

          <div>

            <p-table [value]="menuTipo" [style]="{width:'15rem'}" dataKey="id" selectionMode="single"
              [(selection)]="selectedTipo" (onRowSelect)="onRowSelectTipo($event)"
              (onRowUnselect)="onRowUnselectTipo($event)">
              <ng-template pTemplate="caption">
                <div class="flex align-items-center justify-content-between">
                  Tipo
                </div>
              </ng-template>

              <ng-template pTemplate="body" let-tipo let-rowIndex="rowIndex">
                <tr [pSelectableRow]="tipo">
                  <td>{{tipo.descricao}}</td>
                </tr>
              </ng-template>
            </p-table>
          </div>

          <div >
            <div class="flex flex-column">
              <div style="text-align: center;">
                <p-table [value]="menuApp" [style]="{width:'25rem'}" dataKey="id" selectionMode="single"
                  [(selection)]="selectedApp" (onRowSelect)="onRowSelectApp($event)"
                  (onRowUnselect)="onRowUnselectApp($event)" [rows]="5" [paginator]="true">
                  <ng-template pTemplate="caption">
                    <div class="flex align-items-center justify-content-between">
                      Aplicações
                    </div>
                  </ng-template>

                  <ng-template pTemplate="body" let-app let-rowIndex="rowIndex">
                    <tr [pSelectableRow]="app">
                      <td>{{app.descricao}}</td>
                    </tr>
                  </ng-template>
                </p-table>
              </div>

              <div style="text-align: center;">

                @if (selectedApp.id) {
                <p-button pRipple severity="success" label="Change" icon="pi pi-file-edit" class="mr-2"
                  (click)="showDialogApp()" [disabled]="!selectedTipo!.id!" />
                } @else {
                <p-button pRipple severity="success" label="New" icon="pi pi-plus" class="mr-2"
                  (click)="showDialogApp()" [disabled]="!selectedTipo!.id!" />
                }
                <p-button pRipple severity="danger" label="Delete" icon="pi pi-trash"
                  (click)="confirmExcluir($event,'app')" [disabled]="!selectedApp!.id! || !selectedTipo!.id!" />
              </div>

            </div>
          </div>
        </div>
      </div>
      <div class="col-12"><p-divider></p-divider></div>
      <div class="col-12">

      </div>
    </div>
  </p-accordionTab>

  <p-accordionTab header="Roles e Tags">
    <div class="grid nested-grid">
      <div class="col-12">
        <div class="flex justify-content-center flex-wrap" style="min-height: 10rem !important;">



          <div class="flex align-items-baseline justify-content-start card" style="margin-top: 5rem; ">
            <div class="flex flex-column">
              <div style="text-align: center;">
                <p-table [value]="roleTags" [style]="{width:'20rem'}" dataKey="id" selectionMode="single"
                  [(selection)]="selectedRoleTag" (onRowSelect)="onRowSelectRoleTag($event)"
                  (onRowUnselect)="onRowUnselectRoleTag($event)">
                  <ng-template pTemplate="caption">
                    <div class="flex align-items-center justify-content-between">
                      Tags
                    </div>
                  </ng-template>
                  <ng-template pTemplate="header">
                    <tr>
                      <th>Tag</th>
                      <th>Descrição</th>
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="body" let-tag let-rowIndex="rowIndex">
                    <tr [pSelectableRow]="tag">
                      <td>{{tag.tag}}</td>
                      <td>{{tag.descricao}}</td>
                    </tr>
                  </ng-template>
                </p-table>
              </div>

              <div style="text-align: center;">

                @if (selectedRoleTag.id) {
                <p-button pRipple severity="success" label="Change" icon="pi pi-file-edit" class="mr-2"
                  (click)="showDialogTag()" />
                } @else {
                <p-button pRipple severity="success" label="New" icon="pi pi-plus" class="mr-2"
                  (click)="showDialogTag()" [disabled]="!selectedRole.id" />
                }

                <p-button pRipple severity="danger" label="Delete" icon="pi pi-trash"
                  (click)="confirmExcluir($event,'tag')" [disabled]="!selectedRoleTag.id" />

              </div>

            </div>

          </div>

          <div class="flex align-items-baseline justify-content-center card">

            <div class="flex flex-column">

              <div style="text-align: center;">
                <p-table [value]="roles" [style]="{width:'20rem'}" dataKey="id" selectionMode="single"
                  [(selection)]="selectedRole" (onRowSelect)="onRowSelectRole($event)"
                  (onRowUnselect)="onRowUnselectRole($event)">
                  <ng-template pTemplate="caption">
                    <div class="flex align-items-center justify-content-between">
                      Roles
                    </div>
                  </ng-template>
                  <ng-template pTemplate="header">
                    <tr>
                      <th>Tag</th>
                      <th>Descrição</th>
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="body" let-role let-rowIndex="rowIndex">
                    <tr [pSelectableRow]="role">
                      <td>{{role.tag}}</td>
                      <td>{{role.descricao}}</td>
                    </tr>
                  </ng-template>
                </p-table>
              </div>
              <div style="text-align: center;">
                <p-divider></p-divider>
              </div>
              <div style="text-align: center;">

                @if (selectedRole.id) {
                <p-button pRipple severity="success" label="Change" icon="pi pi-file-edit" class="mr-2"
                  (click)="showDialogRole()" />
                } @else {
                <p-button pRipple severity="success" label="New" icon="pi pi-plus" class="mr-2"
                  (click)="showDialogRole()" [disabled]="!selectedApp.id" />
                }
                <p-button pRipple severity="danger" label="Delete" icon="pi pi-trash"
                  (click)="confirmExcluir($event,'role')" [disabled]="!selectedRole.id" />

              </div>

            </div>

          </div>


          <div class="flex align-items-baseline justify-content-start card" style="margin-top: 5rem;">
            <div class="flex flex-column">
              <div style="text-align: center;">
                <p-table [value]="roleUsers" [style]="{width:'20rem'}" dataKey="id" selectionMode="single"
                  [(selection)]="selectedRoleUsers" (onRowSelect)="onRowSelectRoleUser($event)"
                  (onRowUnselect)="onRowUnselectRoleUser($event)">
                  <ng-template pTemplate="caption">
                    <div class="flex align-items-center justify-content-between">
                      Users
                    </div>
                  </ng-template>
                  <ng-template pTemplate="header">
                    <tr>
                      <th>Login</th>
                      <th>Nome</th>
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="body" let-roleUser let-rowIndex="rowIndex">
                    <tr [pSelectableRow]="roleUser">
                      <td>{{roleUser!.usuario!.login!}}</td>
                      <td>{{roleUser!.usuario!.nome!}}</td>
                    </tr>
                  </ng-template>
                </p-table>
              </div>

              <div style="text-align: center;">
                <p-button pRipple severity="success" label="New" icon="pi pi-plus" class="mr-2"
                  (click)="showListUsers('roleUser')" [disabled]="!selectedRole.id" />
                <p-button pRipple severity="danger" label="Delete" icon="pi pi-trash"
                  (click)="confirmExcluir($event,'roleUser')" [disabled]="!selectedRoleUsers.id" />
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </p-accordionTab>


  <p-accordionTab header="Usuários">
    <div class="grid nested-grid">
      <div class="col-12">
        <div class="flex justify-content-center flex-wrap" style="min-height: 20rem !important;">

          <div class="flex align-items-baseline justify-content-center card">

            <div class="flex flex-column">

              <div style="text-align: center;">

                <form [formGroup]="formUser">
                  <div style="margin: 10px;">
                    <div class="card">

                      <div class="grid" style="margin: 5px;">

                        <div class="col-12">
                          <app-menu-crud (clickSalvar)="emmitterUsuarioCrudSalvar($event)"
                            (clickAdicionar)="emmitterUsuarioCrudAdicionar($event)"
                            (clickExcluir)="emmitterUsuarioCrudExcluir($event)" [habilitarBotaoSalvar]="formUser.valid"
                            [habilitarBotaoExcluir]="formUser.value.id"></app-menu-crud>
                        </div>

                        <div class="col-12">
                          <div class="field grid">
                            <label for="login" class="col-fixed" style="width: 1rem"><p-button pRipple severity="info"
                                label="Login" icon="pi pi-list" class="mr-2"
                                (click)="showListUsers('formUser')" /></label>
                            <div class="col">
                              <input pInputText id="login" formControlName="login" style="width: 20rem">
                            </div>
                          </div>

                          <div class="field grid">
                            <label for="nome" class="col-fixed" style="width: 1rem">Nome</label>
                            <div class="col">
                              <input pInputText id="nome" formControlName="nome" style="width: 20rem">
                            </div>
                          </div>

                          <div class="field grid">
                            <label for="pass" class="col-fixed" style="width: 1rem">Senha</label>
                            <div class="col">
                              <p-password id="pass" formControlName="password" [feedback]="false" [toggleMask]="true"
                                [style]="{'width': '20rem'}" [inputStyle]="{'width':'20rem'}"></p-password>
                            </div>
                          </div>

                        </div>

                      </div>
                    </div>

                  </div>

                </form>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>
  </p-accordionTab>

</p-accordion>



<p-dialog id="dialogApp" [(visible)]="visibleApp" [style]="{ width: '50rem' }" [modal]="true"
  (onHide)="onHideDialogApp()">

  <ng-template pTemplate="header">
    <span class="font-bold">Cadastro de APP</span>
    <span>Módulo {{selectedModulo.descricao}}</span>

  </ng-template>

  <form [formGroup]="formApp">
    <div style="margin: 5px;">
      <div class="grid">
        <div class="col-12">
          <!-- <div class="card"> -->
          <div class="grid">
            <div class="col-12" style="text-align: left;">
              <div class="field grid">
                <label for="menuTipo" class="col-fixed" style="width: 5rem">Tipo</label>
                <div class="col">
                  <p-dropdown id="menuTipo" formControlName="menuTipo" [options]="menuTipo" optionValue="id" optionLabel="descricao"
                    placeholder="Selecione Tipo" />
                </div>
              </div>
            </div>

            <div class="col-12" style="text-align: left;">

              <div class="field grid">
                <label for="link" class="col-fixed" style="width: 5rem">Link</label>
                <div class="col">
                  <input pInputText id="link" formControlName="link" style="width: 20rem">
                </div>
              </div>
              <div class="field grid">
                <label for="descricao" class="col-fixed" style="width: 5rem">Descrição</label>
                <div class="col">
                  <input pInputText id="descricao" formControlName="descricao" style="width: 20rem" />
                </div>
              </div>
              <div class="field grid">
                <label for="ordem" class="col-fixed" style="width: 5rem">Ordem2</label>
                <div class="col">
                  <input id="ordem" formControlName="ordem" [style]="{'width': '2rem'}" />
                </div>
              </div>
              <div class="field grid">
                <label for="publico" class="col-fixed" style="width: 5rem">Público</label>
                <div class="col">
                  <p-selectButton formControlName="publico" [options]="publicoOptions" formControlName="publico"
                    optionLabel="label" optionValue="value" />
                </div>
              </div>


            </div>
            <!-- </div> -->
          </div>
        </div>

        <div class="col-12">
          <p-divider></p-divider>
        </div>
        <div class="col-12">
          <button title="Salvar" label="Salvar" pButton pRipple (click)="saveApp()" pTooltip="Salvar"
            class="p-button-success" icon="pi pi-save"></button>
          <button title="Fechar" label="Sair" pButton pRipple (click)="closeDialogApp()" pTooltip="Salvar"
            class="p-button-secondary" icon="pi pi-arrow-right"></button>
        </div>
      </div>
    </div>
  </form>

</p-dialog>

<p-dialog id="dialogRole" [(visible)]="visibleRole" [style]="{ width: '40rem' }" [modal]="true"
  (onHide)="onHideDialogApp()">

  <ng-template pTemplate="header">
    <span class="font-bold">Cadastro de Roles</span>
    <span>App {{selectedApp.descricao}}</span>

  </ng-template>

  <form [formGroup]="formRole">
    <div style="margin: 5px;">
      <div class="grid">
        <div class="col-12">
          <!-- <div class="card"> -->
          <div class="grid">

            <div class="col-12">
              <p-divider></p-divider>
            </div>
            <div class="col-12" style="text-align: left;">
              <div class="field grid">
                <label for="tag" class="col-fixed" style="width: 5rem">Tag</label>
                <div class="col">
                  <input pInputText id="tag" formControlName="tag" style="width: 20rem">
                </div>
              </div>
              <div class="field grid">
                <label for="descricao" class="col-fixed" style="width: 5rem">Descrição</label>
                <div class="col">
                  <input pInputText id="descricao" formControlName="descricao" style="width: 20rem">
                </div>
              </div>
            </div>
            <!-- </div> -->
          </div>
        </div>

        <div class="col-12">
          <p-divider></p-divider>
        </div>
        <div class="col-12">
          <button title="Salvar" label="Salvar" pButton pRipple (click)="saveRole()" pTooltip="Salvar"
            class="p-button-success" icon="pi pi-save"></button>
          <button title="Fechar" label="Sair" pButton pRipple (click)="closeDialogRole()" pTooltip="Salvar"
            class="p-button-secondary" icon="pi pi-arrow-right"></button>
        </div>
      </div>
    </div>
  </form>

</p-dialog>

<p-dialog id="dialogTag" [(visible)]="visibleTag" [style]="{ width: '40rem' }" [modal]="true"
  (onHide)="onHideDialogApp()">

  <ng-template pTemplate="header">
    <span class="font-bold">Cadastro de Tag</span>
    <span>App {{selectedApp.descricao}} -> Role {{selectedRole.tag}}</span>

  </ng-template>

  <form [formGroup]="formTag">
    <div style="margin: 5px;">
      <div class="grid">
        <div class="col-12">
          <!-- <div class="card"> -->
          <div class="grid">

            <div class="col-12">
              <p-divider></p-divider>
            </div>
            <div class="col-12" style="text-align: left;">
              <div class="field grid">
                <label for="tag" class="col-fixed" style="width: 5rem">Tag</label>
                <div class="col">
                  <input pInputText id="tag" formControlName="tag" style="width: 20rem">
                </div>
              </div>
              <div class="field grid">
                <label for="descricao" class="col-fixed" style="width: 5rem">Descrição</label>
                <div class="col">
                  <input pInputText id="descricao" formControlName="descricao" style="width: 20rem">
                </div>
              </div>
            </div>
            <!-- </div> -->
          </div>
        </div>

        <div class="col-12">
          <p-divider></p-divider>
        </div>
        <div class="col-12">
          <button title="Salvar" label="Salvar" pButton pRipple (click)="saveTag()" pTooltip="Salvar"
            class="p-button-success" icon="pi pi-save"></button>
          <button title="Fechar" label="Sair" pButton pRipple (click)="closeDialogTag()" pTooltip="Salvar"
            class="p-button-secondary" icon="pi pi-arrow-right"></button>
        </div>
      </div>
    </div>
  </form>

</p-dialog>



<p-dialog id="dialogModulo" [(visible)]="visibleModulo" [style]="{ width: '40rem' }" [modal]="true"
  (onHide)="onHideDialogApp()">

  <ng-template pTemplate="header">
    <span class="font-bold">Cadastro de Módulo</span>

  </ng-template>
  <span class="font-bold">Módulo {{selectedGestao.descricao}}</span>
  <form [formGroup]="formModulo">
    <div style="margin: 5px;">
      <div class="grid">
        <div class="col-12">
          <!-- <div class="card"> -->
          <div class="grid">

            <div class="col-12">
              <p-divider></p-divider>
            </div>
            <div class="col-12" style="text-align: left;">
              <div class="field grid">
                <label for="descricao" class="col-fixed" style="width: 5rem">Descrição</label>
                <div class="col">
                  <input pInputText id="descricao" formControlName="descricao" style="width: 20rem">
                </div>
              </div>
            </div>
            <!-- </div> -->
          </div>
        </div>

        <div class="col-12">
          <p-divider></p-divider>
        </div>
        <div class="col-12">
          <button title="Salvar" label="Salvar" pButton pRipple (click)="saveModulo()" pTooltip="Salvar"
            class="p-button-success" icon="pi pi-save"></button>
          <button title="Fechar" label="Sair" pButton pRipple (click)="closeDialogModulo()" pTooltip="Sair"
            class="p-button-secondary" icon="pi pi-arrow-right"></button>
        </div>
      </div>
    </div>
  </form>

</p-dialog>

<app-lista-usuario-page [visible]="visibleListUser" (outputUser)="emitterUser($event)"></app-lista-usuario-page>
<p-toast></p-toast>
